## 理解节点和集群

每一个ElasticSearch的实例叫做节点，多个节点组成了集群，这就是最基本的ElasticSearch云的概念。

#### 准备
为了更好的理解下面的内容，需要一些关于应用节点和集群概念的知识。

#### 它是怎么运行的...
在由可用的RAM、CPU和空闲磁盘组成虚拟容器或者物理机上，我们安装了一个或多个ElasticSearch节点。

一个默认的节点可以存储数据，从而用来处理请求和回应。（在第二章的下载和安装中，我们将会详细的了解如何创建不同的节点和集群拓扑）

在一个节点启动的过程中，会处理很多的逻辑，例如：

- 读取环境变量和__elasticsearch.yml__的配置文件来进行节点的配置
- 通过配置文件或者随机获取一个内建名称变量，并且用此来命名节点
- 在内部，ElasticSearch引擎初始化当前安装版本中所有可用的模块和插件

在节点启动之后，该节点和搜索集群中其他的节点，并且检查其他她的索引和分片状态。
当加入两个及以上的节点时，必须遵守以下的规则：

- 所有节点的ElasticSearch的版本号必须要一致（v0.20、v0.9或v1.4等等）
- 集群的名称必须一致
- 网络必须支持广播搜索的配置（默认）并且保证节点间的连通性。（参考 第二章中的网络设置）

在通常的集群管理中，我们会指定一个主节点，用来处理全部集群级别的操作，而其他的节点，被称为从节点，从节点用于复制主节点的数据和操作。

为了保证写数据操作的一致性，全部的更新操作都会先被提交给主节点，然后再复制给其他从节点。

在多节点的集群中，如果一个主节点死亡后，一个符合主节点标准的节点会被选为新的主节点，通过这样的方法，我们就可以完成一个ElasticSearch集群的自动容灾恢复操作。

#### 更多
在ElasticSearch中有两个关键的操作：非数据节点(non-data node也被称为arbiter)和数据容器(data container)。

非数据节点是用来处理REST请求和全部查询操作的。在每一次操作执行时，ElasticSearch通常会采用map/reduce的方式来执行每次操作：该非数据节点主要负责分配操作给下属的分片，并且负责收集和聚合下属分片的结果，然后再将最终的结果作为回应返回。这些节点会使用大量的内存（RAM）来处理收集，聚合和缓存数据等操作。

数据节点可以存储数据，他们包含分片的索引文件，就像Lucene的索引一样。

当使用普通配置的时候，节点的作用既是非数据节点也是数据容器。

在大的集群架构中，通常会使用大内存的设备作为非数据节点，通过这样的配置就能减少数据节点的资源需求，提升非数据节点对本地内存的搜索性能需求。

#### 参考

第2章下载和安装中[设置不同节点类型](../2.DownloadingAndSetup/SettingUpDifferentNodeTypes.md)
